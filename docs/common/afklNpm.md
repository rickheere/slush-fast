## Private NPM

Since we can make use of an in-house `npm` repository we can make use of afkl-only packages.


### Configuring your `npm` client

#### Basic usage

##### If you're only using npm at AFKL

In order to use our internal `npm` repository, open `~/.npmrc` in an editor and add the following line.

```bash
registry = https://mvnproxy.eden.klm.com/content/groups/npm-all/
```

##### If you're using npm outside of AFKL as well

Since proxying all npm requests through Nexus only works within the AFKL environment it's advisable
to switch between registries easily.

Take a look at [`npmrc`](https://www.npmjs.com/package/npmrc)

`npmrc` makes it possible to create and switch between multiple `.npmrc' profiles.

###### Creating profiles.

This will copy your current profile, create a new afkl profile and set the afkl profile as default.

```bash
~ npmrc -c default
~ npmrc -c afkl
~ npmrc afkl
```

Open `~/.npmrc` add the following

```rc
registry = https://mvnproxy.eden.klm.com/content/groups/npm-all/
```

#### Switching between profiles

To view all profiles type

```bash
~  npmrc
Available npmrcs:

* afkl
default
```

Switching to your default profile
```bash
~  npmrc default
Removing old .npmrc (afkl)
Activating .npmrc "default"
```

Switching to your afkl profile
```bash
~  npmrc afkl
Removing old .npmrc (default)
Activating .npmrc "afkl"
```


#### Publishing packages

Using a private registry in Nexus as a npm formatted hosted repository allows you to create your own packages and share with them via Nexus. This allows you to e.g. share packages between different departments or team or even with external partner organizations.

Deploying packages requires the addition of a publishConfig to your package.json that points to the private registry you want to publish to using the Repository Path URL from the repository list:

```json
"publishConfig": {
  "registry": "https://mvnproxy.eden.klm.com/content/repositories/npm-internal/"
},
```

The deployment requires the user running the deployment to be authenticated. It can be configured by adding an _auth value to npmrc. The value has to be generated by base64-encoding the string of username:password. You can create this encoded string with the command line call openssl e.g.: for the default admin user of Nexus:

```bash
~ echo -n 'x078301:admin123' | openssl base64
```

Other tools for the encoding are uuencode or, for Windows users, certutil. To use certutil on Windows you need to put the credentials to be encoded into a file:

```
x078301:admin123
```
Then run:

```powershell
c:\certutil /encode in.txt out.txt
```

After this the base64 encoded credentials can be found in between the begin and end certiicate lines in the output file:

```
-----BEGIN CERTIFICATE-----
eDA3ODMwMTphZG1pbjEyMw==
-----END CERTIFICATE-----
```
Once you have the encoded credentials the value as well as author information can then be added to the `.npmrc` file:

```bash
registry=https://mvnproxy.eden.klm.com/content/groups/npm-all/
init.author.name=JP Wesselink
init.author.email=j.wesselink@klm.com
init.author.url=http://www.klm.com
# an email is required to publish npm packages
email=j.wesselink@klm.com
_auth=eDA3ODMwMTphZG1pbjEyMw==
```

Now you're ready to publish npm packages like so:

```bash
npm publish
```


* I will never use `admin123` as password. 
